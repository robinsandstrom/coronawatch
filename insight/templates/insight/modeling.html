<!DOCTYPE html>

<html>

<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, minimum-scale=1.0 minimal-ui"/>
    <meta name="description" content=""/>
    <meta name="author" content=""/>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-160071660-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-160071660-1');
    </script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://www.amcharts.com/lib/4/core.js"></script>
    <script src="https://www.amcharts.com/lib/4/charts.js"></script>
    <script src="https://www.amcharts.com/lib/4/themes/animated.js"></script>
    <script src="https://www.amcharts.com/lib/4/maps.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
    </script>
    {% load static %}
    <script rel="{% static 'swe.js' %}"></script>
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <link rel="stylesheet" href="{% static 'bootstrap-grid.css' %}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <link rel="shortcut icon" type="image/png" href="{% static 'favicon.ico' %}"/>
    <title>Coronawatch: {{ total }} (+ {{new_cases}} nya fall)</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.14.0/css/mdb.min.css" rel="stylesheet">

    <meta property="og:title" content="Coronawatch.se" />
    <meta property="og:description" content="Utvecklingen av CoVid-19 i Sverige"/>
    <meta property="og:type" content="Senaste prognos" />
    <meta property="og:url" content="https://www.coronawatch.se/" />
    <meta property="og:image" content="static/graph2.png" />
</head>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Om modellen</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Modellen använder sig av en såkallad SEQIJR-modell med 6 olika stadier: <br>
        S - Suspectibles <br>
        E - Exposed <br>
        Q - Quarantined <br>
        I - Infective <br>
        J - Isolated <br>
        R - Recovered <br>
        <br>
        Du kan justera parametrarna för att avgöra flödena mellan de olika stadierna. Du kan även justera
        andelen av populationen som beblandas. När du ser att kurvorna passar mätpunkterna kan du förlänga modellen
        in i framtiden för att få en prognos. <br>
        <br>
        Modellen ska inte tolkas som en absolut sanning utan enbart ett verktyg för att förstå epidemisk spridning och
        enkelt få återkoppling på hur ändringar i beteende eller smittsamhet påverkar spridningen över tid.
        <br>
        För den som vill läsa mer finns modellen publicerad på GITHUB här: <br>
        <br>
        <a href="https://github.com/robinsandstrom/SEQJIR/">SEQIJR</a>
        <br>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success" data-dismiss="modal">Stäng</button>
      </div>
    </div>
  </div>
</div>

<body class="">
        <!-- As a link -->
    <nav class="navbar pt-2 navbar-dark blue-grey z-depth-0 text-left">
        <img style="height: 2.5rem;" src="{% static 'virus_cw.svg' %}" class="pr-4">
        <a class="navbar-brand mr-auto py-0 my-0" href="/" style="font-family: biohazard;">coronawatch.se</a>
        <h6 class="text-white text-uppercase pr-1">Senast uppdaterad: </h6><h4 class="ml-1 text-uppercase text-white"><strong>{{ last_updated }}</strong></h4>
    </nav>
    <div class="row m-0 p-0" style="min-height: 95vh;">
        <div class="col-sm-12 col-lg-3 m-0 p-0">
            <div class="card mx-sm-0 my-0 z-depth-0" style="background-color: #f0f2f6;">
                <div class="card-body">
                    <h4 class="font-weight-light"  style="display:inline-block;">SEIR</h4>
                    <table style="display:inline-block;">
                        <tr>
                            <td>
                                <select id="country" class="js-example-basic-single" style="width: 150px;">
                                  <option value="Denmark">Danmark</option>
                                  <option value="Finland">Finland</option>
                                  <option value="France">Frankrike</option>
                                  <option value="Germany">Tyskland</option>
                                  <option value="Italy">Italien</option>
                                  <option value="Netherlands">Nederländerna</option>
                                  <option value="Norway">Norge</option>
                                  <option value="Sweden" selected>Sverige</option>
                                  <option value="South Korea">Sydkorea</option>
                                  <option value="Spain">Spanien</option>
                                  <option value="United_Kingdom">Storbrittanien</option>
                                  <option value="United_States_of_America">USA</option>
                                  <option value="Switzerland">Schweiz</option>
                                </select>
                            </td>
                            <td>
                                <select id="region" class="js-example-basic-single" style="width: 150px;">
                                        <option value="Sverige" selected>Hela Sverige</option>
                                        <option value="Stockholm">Stockholm</option>
                                        <option value="Uppsala">Uppsala</option>
                                        <option value="Södermanland">Södermanland</option>
                                        <option value="Östergötland">Östergötland</option>
                                        <option value="Jönköping">Jönköping</option>
                                        <option value="Kronoberg">Kronoberg</option>
                                        <option value="Kalmar">Kalmar</option>
                                        <option value="Gotland">Gotland</option>
                                        <option value="Blekinge">Blekinge</option>
                                        <option value="Skåne">Skåne</option>
                                        <option value="Halland">Halland</option>
                                        <option value="Västra Götaland">Västra Götaland</option>
                                        <option value="Värmland">Värmland</option>
                                        <option value="Örebro">Örebro</option>
                                        <option value="Västmanland">Västmanland</option>
                                        <option value="Dalarna">Dalarna</option>
                                        <option value="Gävleborg">Gävleborg</option>
                                        <option value="Västernorrland">Västernorrland</option>
                                        <option value="Jämtland">Jämtland</option>
                                        <option value="Västerbotten">Västerbotten</option>
                                        <option value="Norrbotten">Norrbotten</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2"><hr></td>
                        </tr>
                    </table>
                    <div class="form-group">
                      <label for="N" class="font-weight-light text-small pl-1 mb-0">Befolkningsandel utan självkarantän (0-1)</label>
                      <div class="input-group mt-0">
                          <input type="number" id="N" class="form-control form-control-lg mt-0" step="0.01" value="0.0003" min="0" max="1">
                          <input type="button" value="-" class="button-minus" data-field="quantity">
                          <input type="button" value="+" class="button-plus" data-field="quantity">
                      </div>
                    </div>
                    <div class="form-group">
                        <label for="pi" class="font-weight-light text-small pl-1 mb-0">Inflöde av mottagliga människor</label>
                        <div class="input-group mt-0">
                            <input type="number" id="pi" class="form-control form-control-lg mt-0" step="1000" value="0">
                            <input type="button" value="-" class="button-minus" data-field="quantity">
                            <input type="button" value="+" class="button-plus" data-field="quantity">
                        </div>
                    </div>
                    <hr class="text-white">
                    <div class="form-group">
                        <label for="b" class="font-weight-light text-small pl-1 mb-0">Smittsamhet</label>
                        <div class="input-group mt-0">
                            <input type="number" id="b" class="form-control form-control-lg mt-0" step="0.01" value="0.67" min="0" max="10">
                            <input type="button" value="-" class="button-minus" data-field="quantity">
                            <input type="button" value="+" class="button-plus" data-field="quantity">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="e_E" class="font-weight-light text-small pl-1 mb-0">Asymptomatisk smittsamhet</label>
                        <div class="input-group mt-0">
                            <input type="number" id="e_E" class="form-control form-control-lg mt-0" step="0.01" value="0.5" min="0" max="1">
                            <input type="button" value="-" class="button-minus" data-field="quantity">
                            <input type="button" value="+" class="button-plus" data-field="quantity">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="s_1" class="font-weight-light text-small pl-1 mb-0">Tillfriskning, smittsamma</label>
                        <div class="input-group mt-0">
                            <input type="number" id="s_1" class="form-control form-control-lg mt-0" step="0.01" value="0.5" min="0" max="1">
                            <input type="button" value="-" class="button-minus" data-field="quantity">
                            <input type="button" value="+" class="button-plus" data-field="quantity">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="k_1" class="font-weight-light text-small pl-1 mb-0">Symptomutvecklingsgrad</label>
                        <div class="input-group mt-0">
                            <input type="number" id="k_1" class="form-control form-control-lg mt-0" step="0.01" value="0.4" min="0" max="1">
                            <input type="button" value="-" class="button-minus" data-field="quantity">
                            <input type="button" value="+" class="button-plus" data-field="quantity">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="d_1" class="font-weight-light text-small pl-1 mb-0">Dödstakt för smittsamma</label>
                        <div class="input-group mt-0">
                            <input type="number" id="d_1" class="form-control form-control-lg mt-0" step="0.01" value="0.004" min="0" max="1">
                            <input type="button" value="-" class="button-minus" data-field="quantity">
                            <input type="button" value="+" class="button-plus" data-field="quantity">
                        </div>
                    </div>
                    <h4 class="font-weight-light mt-4 pt-4">QJ</h4>
                    <hr>
                    <div class="form-group">
                        <label for="k_2" class="font-weight-light text-small pl-1 mb-0">Symptomutvecklingsgrad i karantän</label>
                        <div class="input-group mt-0">
                            <input type="number" id="k_2" class="form-control form-control-lg mt-0" step="0.01" value="0" min="0" max="1">
                            <input type="button" value="-" class="button-minus" data-field="quantity">
                            <input type="button" value="+" class="button-plus" data-field="quantity">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="e_Q" class="font-weight-light text-small pl-1 mb-0">Karantänad smittsamhet</label>
                        <div class="input-group mt-0">
                            <input type="number" id="e_Q" class="form-control form-control-lg mt-0" step="0.01" value="0" min="0" max="1">
                            <input type="button" value="-" class="button-minus" data-field="quantity">
                            <input type="button" value="+" class="button-plus" data-field="quantity">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="e_J" class="font-weight-light text-small pl-1 mb-0">Isolerad smittsamhet</label>
                        <div class="input-group mt-0">
                            <input type="number" id="e_J" class="form-control form-control-lg mt-0" step="0.01" value="0" min="0" max="1">
                            <input type="button" value="-" class="button-minus" data-field="quantity">
                            <input type="button" value="+" class="button-plus" data-field="quantity">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="g_1" class="font-weight-light text-small pl-1 mb-0">Karantänsgrad</label>
                        <div class="input-group mt-0">
                            <input type="number" id="g_1" class="form-control form-control-lg mt-0" step="0.01" value="0" min="0" max="1">
                            <input type="button" value="-" class="button-minus" data-field="quantity">
                            <input type="button" value="+" class="button-plus" data-field="quantity">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="g_2" class="font-weight-light text-small pl-1 mb-0">Isoleringsgrad för smittsamma</label>
                        <div class="input-group mt-0">
                            <input type="number" id="g_2" class="form-control form-control-lg mt-0" step="0.01" value="0" min="0" max="1">
                            <input type="button" value="-" class="button-minus" data-field="quantity">
                            <input type="button" value="+" class="button-plus" data-field="quantity">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="s_2" class="font-weight-light text-small pl-1 mb-0">Tillfriskning, isolerade</label>
                        <div class="input-group mt-0">
                            <input type="number" id="s_2" class="form-control form-control-lg mt-0" step="0.01" value="0" min="0" max="1">
                            <input type="button" value="-" class="button-minus" data-field="quantity">
                            <input type="button" value="+" class="button-plus" data-field="quantity">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="d_2" class="font-weight-light text-small pl-1 mb-0">Dödstakt för isolerade</label>
                        <div class="input-group mt-0">
                            <input type="number" id="d_2" class="form-control form-control-lg mt-0" step="0.01" value="0" min="0" max="1">
                            <input type="button" value="-" class="button-minus" data-field="quantity">
                            <input type="button" value="+" class="button-plus" data-field="quantity">
                        </div>
                    </div>
                    <div class="text-center my-2">
                        <button class="btn btn-info text-center z-depth-0" type="button" name="button" id="calc">Beräkna</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-sm-12 col-lg-9 m-0 p-0 px-5">
            <div class="card mx-sm-2 mt-0 pt-4 z-depth-0">
                    <div class="row">
                        <div class="col-sm-6">
                            <h1 id="ro" style="display: inline-block;" class="pr-2"</h1>
                            <h1 id="rc" style="display: inline-block;"></h1>
                        </div>
                        <div class="col-sm-6 my-0">
                            <button type="button" class="mt-4 py-0 btn-sm btn btn-info float-right z-depth-0" data-toggle="modal" data-target="#exampleModal">
                              Om modellen
                            </button>
                        </div>
                        <div class="col-sm-12">
                            <div class="d-flex justify-content-center my-4">
                              <div class="w-75">
                                 <label for="p_days" class="text-muted">Antal dagar att beräkna i framtiden</label>
                                <input type="range" class="custom-range" id="p_days" min="0" max="200" value="0">
                              </div>
                              <span class="font-weight-bold text-primary ml-2 valueSpan2"></span>
                            </div>
                        </div>
                    </div>
                <div class="card-body">
                    <h1 class="pl-2 font-weight-light"><br></h1>
                    <div id="graph_1" class="chartdiv px-0" style="height: 400px;"></div>
                    <div class="row">
                        <div class="col-md-12 my-2">
                            <select id="graph_1_mp" class="float-right js-example-basic-single">
                              <option value="cases_confirmed" selected>Confirmed cases (I)</option>
                              <option value="deaths_confirmed">Confirmed deaths (J)</option>
                              <option value="no_measurement">No measurement</option>
                            </select>
                            <select id="graph_1_display" class="float-right js-example-basic-single" style="width: 350px;">
                              <option value="infective">Infective (I)</option>
                              <option value="intensive_care">Intensive Care (IC)</option>
                              <option value="hospital_care">Hospital Care (HC)</option>
                              <option value="isolated">Isolated (J)</option>
                              <option value="susceptibles">Suspectibles (S)</option>
                              <option value="quarantined">Quarantined (Q)</option>
                              <option value="exposed">Exposed (E)</option>
                              <option value="removed">Accumulated recovered (R)</option>
                              <option value="accumulated_isolated">Accumulated Isolated (AJ)</option>
                              <option value="accumulated_isolated_infective" selected>Accumulated Isolated+Infective (AJI)</option>
                              <option value="accumulated_deaths">Accumulated Deaths (AD)</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card mx-sm-0 my-2 z-depth-0">
                <div class="card-body">
                    <div id="graph_2" class="chartdiv" style="height: 400px;"></div>
                    <div class="row">
                        <div class="col-md-12 my-3">
                            <select id="graph_2_mp" class="float-right js-example-basic-single">
                              <option value="cases_confirmed">Confirmed cases (I)</option>
                              <option value="deaths_confirmed" selected>Confirmed deaths (J)</option>
                              <option value="no_measurement">No measurement</option>
                            </select>
                            <select id="graph_2_display" class="float-right js-example-basic-single" style="width: 350px;">
                              <option value="infective">Infective (I)</option>
                              <option value="intensive_care">Intensive Care (IC)</option>
                              <option value="hospital_care">Hospital Care (HC)</option>
                              <option value="isolated">Isolated (J)</option>
                              <option value="susceptibles">Suspectibles (S)</option>
                              <option value="quarantined">Quarantined (Q)</option>
                              <option value="exposed">Exposed (E)</option>
                              <option value="removed">Accumulated recovered (R)</option>
                              <option value="accumulated_isolated">Accumulated Isolated (AJ)</option>
                              <option value="accumulated_isolated_infective">Accumulated Isolated+Infective (AJI)</option>
                              <option value="accumulated_deaths" selected>Accumulated Deaths (AD)</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

</body>
<style media="screen">
    input,
textarea {
  border: 1px solid #eeeeee;
  box-sizing: border-box;
  margin: 0;
  outline: none;
  padding: 10px;
}

input[type="button"] {
  -webkit-appearance: button;
  cursor: pointer;
}

input::-webkit-outer-spin-button,
input::-webkit-inner-spin-button {
  -webkit-appearance: none;
}

.input-group {
  clear: both;
  margin: 15px 0;
  position: relative;
}

.input-group input[type='button'] {
  background-color: #929fba;
  min-width: 48px;
  width: auto;
  transition: all 300ms ease;
}

.input-group .button-minus,
.input-group .button-plus {
  font-weight: bold;
  height: 48px;
  padding: 0;
  width: 48px;
  position: relative;
}

.input-group .button-minus{
    margin-right: 12px;
}

.input-group .quantity-field {
  position: relative;
  height: 48px;
  left: -6px;
  text-align: center;
  width: 62px;
  display: inline-block;
  font-size: 13px;
  margin: 0 0 5px;
  resize: vertical;
}

.button-plus {
  left: -13px;
}

g[aria-labelledby^='id'] {
    opacity: 0;
    color: red;
}

input[type="number"] {
  -moz-appearance: textfield;
  -webkit-appearance: none;
}
</style>
<script type="text/javascript">
$(document).ready(function() {

    $('.js-example-basic-single').select2({
        minimumResultsForSearch: -1,
    });

  const $valueSpan = $('.valueSpan2');
  const $value = $('#p_days');
  $valueSpan.html($value.val());
  $value.on('input change', () => {

    $valueSpan.html($value.val());
  });

  $('.button-minus').click(function () {
        var $input = $(this).parent().find('[type=number]');
        var step = $input.attr('step');
        var min = parseFloat($input.attr('min'));
        var max = parseFloat($input.attr('max'));
        if(step.indexOf('.')>-1){
            var j=2;
        }else{
            var j=0;
        }
  		var count = (parseFloat($input.val()) - parseFloat(step)).toFixed(j);
        count = count < min ? min : count;
        count = count > max ? max : count;
  	    $input.val(count);
  	    $input.change();
  	    return false;

    });

    $('.button-plus').click(function () {
  		var $input = $(this).parent().find('[type=number]');
        var step = $input.attr('step');
        var min = parseFloat($input.attr('min'));
        var max = parseFloat($input.attr('max'));
        if(step.indexOf('.')>-1){
            var j=2;
        }else{
            var j=0;
        }
        var count = (parseFloat($input.val()) + parseFloat(step)).toFixed(j);
        count = count < min ? min : count;
        count = count > max ? max : count;
        $input.val(count);
  		$input.change();
  		return false;
  	});
});
am4core.ready(function() {

    // Themes begin
    am4core.useTheme(am4themes_animated);
    // Create chart instance
    var chart = am4core.create("graph_1", am4charts.XYChart);
    var chart2 = am4core.create("graph_2", am4charts.XYChart);
    var sum_data;

    $('#calc').click(function() {
        loadNewData();
    });


    $('#country').on('change', function() {
        if($(this).val()!='Sweden'){
            $('#region').attr('disabled', true)
        }else{
            $('#region').attr('disabled', false)
        }
    });

    $('#graph_1_mp').on('change', function() {
        measurement_1 = $(this).val();
        populateGraph1();
    });

    $('#graph_2_mp').on('change', function() {
        measurement_2 = $(this).val();
        populateGraph2();
    });

    $('#graph_1_display').on('change', function() {
        display_1 = $(this).val();
        populateGraph1();
    });

    $('#graph_2_display').on('change', function() {
        display_2 = $(this).val();
        populateGraph2();
    });

    loadNewData();

    var health_cap = $('#health_cap').val();

    var colors = ['#4285F4', '#2BBBAD', '#2BBBAD', '#fb8c00', '#ef6c00', '#CC0000', '#ff8f00', '#ffeb3b'];

    var display_1 = $('#graph_1_display').val();
    var measurement_1 = 'cases_confirmed';

    var display_2 = $('#graph_2_display').val();
    var measurement_2 = 'deaths_confirmed';


    function reloadData(params){
        $.ajax({
                type: "GET",
                url: '/api/get_curve',
                data: params,
                cache: true,
                success: fetchSuccess,
                dataType: 'json',
            });
        }

    function fetchSuccess(Data, textStatus, jqXHR){
        sum_data = Data;
        populateGraph1();
        populateGraph2();
        updateR();
    }

    function updateR(){
        console.log('updateing R');
        $('#rc').text('RC:'+ sum_data['key_figures']['RC'].toFixed(2))
        $('#ro').text('RO:'+ sum_data['key_figures']['R0'].toFixed(2)  + ' | ')
    }

    $(document).on('keypress',function(e) {
        if(e.which == 13) {
            loadNewData();
        }
    });

    function populateGraph1(){
        data = [];

        var measured_points = sum_data[measurement_1];
        var measured_dates = sum_data['dates_measured'];

        for(var i=0; i < measured_points.length; i++){
            m =  ({
                    'ax': new Date(Date.parse(measured_dates[i])),
                    'ay': measured_points[i]
            })
            data.push(m)
        }


        var display_points = sum_data[display_1];
        var dates_prognosis = sum_data['dates_prognosis'];

        for(var i=0; i < display_points.length; i++){
            m =  ({
                    'dx': new Date(Date.parse(dates_prognosis[i])),
                    'dy': display_points[i]
            })
            data.push(m)
        }
        chart.data = data;
    }

    function populateGraph2(){
        data = [];

        var measured_points = sum_data[measurement_2];
        var measured_dates = sum_data['dates_measured'];

        for(var i=0; i < measured_points.length; i++){
            m =  ({
                    'ax': new Date(Date.parse(measured_dates[i])),
                    'ay': measured_points[i]
            })
            data.push(m)
        }


        var display_points = sum_data[display_2];
        var dates_prognosis = sum_data['dates_prognosis'];

        for(var i=0; i < display_points.length; i++){
            m =  ({
                    'dx': new Date(Date.parse(dates_prognosis[i])),
                    'dy': display_points[i]
            })
            data.push(m)
        }
        chart2.data = data;
    }

    function getParams(){
        var p = {};
        var No = $('#N').val()
        var pi  = $('#pi').val()
        var b = $('#b').val()
        var e_E = $('#e_E').val()
        var e_Q = $('#e_Q').val()
        var e_J = $('#e_J').val()
        var g_1 = $('#g_1').val()
        var g_2 = $('#g_2').val()
        var s_1 = $('#s_1').val()
        var s_2 = $('#s_2').val()
        var k_1 = $('#k_1').val()
        var k_2 = $('#k_2').val()
        var d_1 = $('#d_1').val()
        var d_2 = $('#d_2').val()
        var p_days = $('#p_days').val()
        var country = $('#country').val()
        var region = $('#region').val()
        return {
            'N': No,
            'pi': pi,
            'b': b,
            'e_E': e_E,
            'e_Q': e_Q,
            'e_J': e_J,
            'g_1': g_1,
            'g_2': g_2,
            's_1': s_1,
            's_2': s_2,
            'k_1': k_1,
            'k_2': k_2,
            'd_1': d_1,
            'd_2': d_2,
            'p_days': p_days,
            'country' : country,
            'region' : region,
        }
    }

    function loadNewData() {
        params = getParams();
        reloadData(params);
    }

    // Create axes
    var dateAxis = chart.xAxes.push(new am4charts.DateAxis());
    chart.numberFormatter.numberFormat = "#,###.";

    dateAxis.baseInterval = {
      "timeUnit": "minute",
      "count": 1
    };
    dateAxis.tooltipDateFormat = "d MMMM";


    var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
    dateAxis.renderer.grid.template.disabled = true;

    // Create series
    var series = chart.series.push(new am4charts.LineSeries());
    series.dataFields.valueY = "dy";
    series.dataFields.dateX = "dx";
    series.strokeWidth = 2;
    series.fillOpacity = 0;
    series.tooltipText = "{dy}";
    series.tooltip.pointerOrientation = "vertical";
    series.tooltip.background.fillOpacity = 0.5;
    series.tooltip.label.padding(12,12,12,12)


    // Create series
    var measurepoints = chart.series.push(new am4charts.LineSeries());
    measurepoints.dataFields.valueY = "ay";
    measurepoints.dataFields.dateX = "ax";
    measurepoints.strokeOpacity = 0;
    measurepoints.tooltipText = "Mätvärde: {ay}";
    measurepoints.tooltip.pointerOrientation = "vertical";
    measurepoints.tooltip.background.fillOpacity = 0.5;
    measurepoints.tooltip.label.padding(12,12,12,12)

    // Add a bullet
    var bullet = measurepoints.bullets.push(new am4charts.Bullet());

    // Add a triangle to act as am arrow
    var arrow = bullet.createChild(am4core.Triangle);
    arrow.horizontalCenter = "middle";
    arrow.verticalCenter = "middle";
    arrow.strokeWidth = 1;
    arrow.strokeOpacity = 1;
    arrow.stroke = chart.colors.getIndex(0);
    arrow.fillOpacity = 0.8;
    arrow.direction = "top";
    arrow.width = 8;
    arrow.height = 8;

    dateAxis.start = 0;
    //dateAxis.end = 0.05;
    valueAxis.start = 0;
    valueAxis.end = 0.000001;
    dateAxis.keepSelection = true;

    // Add cursor
    chart.cursor = new am4charts.XYCursor();
    chart.cursor.xAxis = dateAxis;
    chart.logo.height = 1000;



    // Create axes
    var dateAxis = chart2.xAxes.push(new am4charts.DateAxis());
    dateAxis.renderer.grid.template.disabled = true;
    dateAxis.baseInterval = {
      "timeUnit": "minute",
      "count": 1
    };
    dateAxis.tooltipDateFormat = "d MMMM";


    var valueAxis = chart2.yAxes.push(new am4charts.ValueAxis());
    chart2.numberFormatter.numberFormat = "#,###.";

    // Create series
    var series = chart2.series.push(new am4charts.LineSeries());
    series.dataFields.valueY = "dy";
    series.dataFields.dateX = "dx";
    series.strokeWidth = 2;
    series.tooltipText = "{dy}";
    series.tooltip.pointerOrientation = "vertical";
    series.tooltip.background.fillOpacity = 0.5;
    series.tooltip.label.padding(12,12,12,12)

    // Create series
    var measurepoints = chart2.series.push(new am4charts.LineSeries());
    measurepoints.dataFields.valueY = "ay";
    measurepoints.dataFields.dateX = "ax";
    measurepoints.strokeOpacity = 0;
    measurepoints.tooltipText = "Mätvärde: {ay}";
    measurepoints.tooltip.pointerOrientation = "vertical";
    measurepoints.tooltip.background.fillOpacity = 0.5;
    measurepoints.tooltip.label.padding(12,12,12,12)

    // Add a bullet
    var bullet = measurepoints.bullets.push(new am4charts.Bullet());

    // Add a triangle to act as am arrow
    var arrow = bullet.createChild(am4core.Triangle);
    arrow.horizontalCenter = "middle";
    arrow.verticalCenter = "middle";
    arrow.strokeWidth = 1;
    arrow.strokeOpacity = 1;
    arrow.stroke = chart.colors.getIndex(0);
    arrow.fillOpacity = 1;
    arrow.direction = "top";
    arrow.width = 8;
    arrow.height = 8;

    dateAxis.start = 0;
    //dateAxis.end = 0.05;
    valueAxis.start = 0;
    valueAxis.end = 0.000001;
    dateAxis.keepSelection = true;


    // Add cursor
    chart2.cursor = new am4charts.XYCursor();
    chart2.cursor.xAxis = dateAxis;


    }); // end am4core.ready()
</script>
